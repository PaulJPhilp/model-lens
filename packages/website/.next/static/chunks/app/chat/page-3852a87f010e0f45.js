(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[457],{977:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>u});var r=n(2858),o=n(9921),i=n(2466),s=n(5522);function l(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"msg";return"".concat(e,"_").concat(Math.random().toString(36).slice(2,9))}function d(e){let t=new Date,n=new Date(e),r=Math.floor((t.getTime()-n.getTime())/1e3),o=Math.floor(r/60),i=Math.floor(o/60),s=Math.floor(i/24);return r<60?"just now":o<60?"".concat(o,"m ago"):i<24?"".concat(i,"h ago"):s<7?"".concat(s,"d ago"):n.toLocaleDateString()}function a(e){return"object"==typeof e&&null!==e&&"type"in e&&"text"===e.type&&"text"in e&&"string"==typeof e.text}function c(e){var t;return(null!=(t=e.parts)?t:[]).filter(a).map(e=>e.text).join("")}function p(e){let{initialSystemMessage:t,userId:n,apiEndpoint:p="/api/chat"}=e,{messages:u,error:f,stop:x,setMessages:g,status:h,sendMessage:y}=(0,o.Y_)({chat:new o.ry({transport:new i.rL({api:p,headers:{"x-user-id":null!=n?n:"00000000-0000-0000-0000-000000000001"},body:{options:{topK:6,includeRuns:!0,includeFilters:!0,stream:!0}}})})}),b="submitted"===h||"streaming"===h,[m,v]=(0,s.useState)(null),[j,S]=(0,s.useState)(""),[k,w]=(0,s.useState)(""),[D,C]=(0,s.useState)(l("conv")),[z,A]=(0,s.useState)([]),[I,N]=(0,s.useState)(!1),[R,_]=(0,s.useState)(null),E=(0,s.useRef)(null);async function O(e){try{var t;let n=await fetch("/api/chat/meta",{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({query:e})});if(!n.ok)return;let r=await n.json();_(null!=(t=r.citations)?t:null)}catch(e){}}function T(){v(null),S("")}function M(){m&&(g(u.map(e=>e.id===m?{...e,parts:[{type:"text",text:j}]}:e)),v(null),S(""))}function F(e){confirm("Delete this conversation?")&&A(t=>t.filter(t=>t.id!==e))}return(0,s.useEffect)(()=>{var e;null==(e=E.current)||e.scrollIntoView({behavior:"smooth",block:"end"})},[]),(0,s.useEffect)(()=>{try{let e=localStorage.getItem("chat-conversations-ai-sdk");e&&A(JSON.parse(e))}catch(e){console.warn("Failed to load conversations:",e)}},[]),(0,s.useEffect)(()=>{try{localStorage.setItem("chat-conversations-ai-sdk",JSON.stringify(z))}catch(e){console.warn("Failed to save conversations:",e)}},[z]),(0,s.useEffect)(()=>{let e=u[u.length-1];if(e&&"assistant"===e.role&&!b){let e=u[u.length-2];if(e&&"user"===e.role){var t;O((null!=(t=e.parts)?t:[]).filter(a).map(e=>e.text).join(""))}}},[u,b,O]),(0,r.jsxs)("div",{style:{display:"flex",flexDirection:"column",height:"100%",border:"1px solid #e6e6e6",borderRadius:8,overflow:"hidden"},children:[(0,r.jsxs)("div",{style:{padding:12,borderBottom:"1px solid #eee",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,r.jsx)("strong",{children:"ModelLens Assistant (AI SDK)"}),(0,r.jsxs)("div",{style:{display:"flex",gap:8},children:[(0,r.jsxs)("button",{type:"button",onClick:()=>N(!I),style:{padding:"6px 12px",borderRadius:4,background:"#f6f8fa",border:"1px solid #ddd",fontSize:12,cursor:"pointer"},title:"Saved conversations",children:["\uD83D\uDCAC ",z.length]}),(0,r.jsx)("button",{type:"button",onClick:function(){if(0===u.length)return;let e=u.find(e=>"user"===e.role),t=e?c(e).slice(0,50):"New Conversation",n=new Date().toISOString(),r=u.map(e=>({id:e.id,role:e.role,content:c(e),createdAt:"object"==typeof e&&"createdAt"in e&&"string"==typeof e.createdAt?e.createdAt:""}));if(z.find(e=>e.id===D))A(e=>e.map(e=>e.id===D?{...e,messages:r,updatedAt:n,title:t}:e));else{let e={id:D,title:t,messages:r,createdAt:n,updatedAt:n};A(t=>[e,...t])}},disabled:0===u.length,style:{padding:"6px 12px",borderRadius:4,background:"#0b5cff",color:"#fff",border:"none",fontSize:12,cursor:0===u.length?"not-allowed":"pointer",opacity:0===u.length?.5:1},title:"Save conversation",children:"\uD83D\uDCBE Save"}),(0,r.jsx)("button",{type:"button",onClick:function(){g(t?[{id:l("sys"),role:"system",parts:[{type:"text",text:t}]}]:[]),C(l("conv")),_(null),N(!1)},style:{padding:"6px 12px",borderRadius:4,background:"#f6f8fa",border:"1px solid #ddd",fontSize:12,cursor:"pointer"},title:"New conversation",children:"➕ New"})]})]}),I&&(0,r.jsx)("div",{style:{maxHeight:200,overflowY:"auto",borderBottom:"1px solid #eee",background:"#f9f9f9"},children:0===z.length?(0,r.jsx)("div",{style:{padding:16,textAlign:"center",color:"#666",fontSize:13},children:"No saved conversations yet"}):(0,r.jsx)("div",{children:z.map(e=>(0,r.jsxs)("div",{style:{padding:"8px 12px",borderBottom:"1px solid #e6e6e6",display:"flex",justifyContent:"space-between",alignItems:"center",background:e.id===D?"#e8f0fe":"transparent",cursor:"default"},children:[(0,r.jsxs)("button",{type:"button",onClick:()=>{g(e.messages.map(e=>({id:e.id,role:e.role,parts:[{type:"text",text:e.content}]}))),C(e.id),N(!1),_(null)},style:{flex:1,overflow:"hidden",textAlign:"left",background:"transparent",border:"none",cursor:"pointer",padding:0},children:[(0,r.jsx)("div",{style:{fontSize:13,fontWeight:500,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:e.title}),(0,r.jsxs)("div",{style:{fontSize:11,color:"#666",marginTop:2},children:[e.messages.length," messages •"," ",d(e.updatedAt)]})]}),(0,r.jsx)("button",{type:"button",onClick:t=>{t.stopPropagation(),F(e.id)},onKeyDown:t=>{("Enter"===t.key||" "===t.key)&&(t.stopPropagation(),F(e.id))},style:{background:"transparent",border:"none",cursor:"pointer",fontSize:14,padding:"4px 8px"},title:"Delete conversation",children:"\uD83D\uDDD1️"})]},e.id))})}),(0,r.jsxs)("div",{style:{flex:1,overflowY:"auto",padding:12,display:"flex",flexDirection:"column",gap:12},children:[u.map(function(e){let t="assistant"===e.role,n=m===e.id;return(0,r.jsx)("div",{style:{display:"flex",gap:8,alignItems:"flex-start",justifyContent:t?"flex-start":"flex-end"},children:(0,r.jsx)("div",{style:{maxWidth:"78%",background:t?"#f6f8fa":"#0b5cff",color:t?"#111":"#fff",padding:"10px 12px",borderRadius:8,whiteSpace:"pre-wrap",wordBreak:"break-word"},children:n?(0,r.jsxs)("div",{children:[(0,r.jsx)("textarea",{value:j,onChange:e=>S(e.target.value),style:{width:"100%",minHeight:60,padding:8,borderRadius:4,border:"1px solid #ddd",fontSize:14,fontFamily:"inherit"}}),(0,r.jsxs)("div",{style:{marginTop:8,display:"flex",gap:8},children:[(0,r.jsx)("button",{type:"button",onClick:M,style:{padding:"6px 12px",borderRadius:4,background:"#0b5cff",color:"#fff",border:"none",fontSize:12,cursor:"pointer"},children:"Save"}),(0,r.jsx)("button",{type:"button",onClick:T,style:{padding:"6px 12px",borderRadius:4,background:"#ddd",color:"#111",border:"none",fontSize:12,cursor:"pointer"},children:"Cancel"})]})]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{style:{fontSize:14},children:c(e)}),(0,r.jsxs)("div",{style:{fontSize:11,color:t?"#666":"rgba(255,255,255,0.8)",marginTop:6,display:"flex",alignItems:"center",gap:8,justifyContent:"space-between"},children:[(0,r.jsx)("span",{children:(()=>{let t=e.createdAt,n="string"==typeof t?t:t instanceof Date?t.toISOString():void 0;return n?d(n):"just now"})()}),"user"===e.role&&!b&&(0,r.jsxs)("div",{style:{display:"flex",gap:6},children:[(0,r.jsx)("button",{type:"button",onClick:()=>{var t;"user"===e.role&&(v(e.id),S((null!=(t=e.parts)?t:[]).filter(a).map(e=>e.text).join("")))},style:{background:"transparent",border:"none",color:"inherit",cursor:"pointer",fontSize:11,padding:"2px 4px"},title:"Edit message",children:"✏️"}),(0,r.jsx)("button",{type:"button",onClick:()=>{var t;return t=e.id,void(confirm("Delete this message?")&&g(u.filter(e=>e.id!==t)))},style:{background:"transparent",border:"none",color:"inherit",cursor:"pointer",fontSize:11,padding:"2px 4px"},title:"Delete message",children:"\uD83D\uDDD1️"})]})]})]})})},e.id)}),(0,r.jsx)("div",{ref:E})]}),(0,r.jsxs)("div",{className:"p-3 border-t border-gray-200",children:[(0,r.jsxs)("form",{onSubmit:function(e){null==e||e.preventDefault();let t=k.trim();t&&!b&&(y({text:t}),w(""))},className:"flex gap-2",children:[(0,r.jsx)("input",{value:k,onChange:function(e){w(e.target.value)},placeholder:"Ask about models, filters, or runs...",className:"flex-1 px-3 py-2 rounded border border-gray-300",disabled:b}),b?(0,r.jsx)("button",{type:"button",onClick:x,style:{padding:"10px 14px",borderRadius:6,background:"#e53e3e",color:"#fff",border:"none",cursor:"pointer"},children:"Stop"}):(0,r.jsx)("button",{type:"submit",style:{padding:"10px 14px",borderRadius:6,background:"#0b5cff",color:"#fff",border:"none",cursor:"pointer"},children:"Send"})]}),f&&(0,r.jsx)("div",{style:{color:"crimson",marginTop:8},children:f.message||String(f)}),(0,r.jsxs)("div",{style:{marginTop:12},children:[(0,r.jsx)("strong",{children:"Sources"}),!R&&(0,r.jsx)("div",{style:{color:"#666",fontSize:13},children:"No sources yet"}),R&&0===R.length&&(0,r.jsx)("div",{style:{color:"#666",fontSize:13},children:"No sources returned"}),R&&R.length>0&&(0,r.jsx)("div",{style:{display:"grid",gap:8,marginTop:8},children:R.map((e,t)=>{var n,o;return(0,r.jsxs)("div",{style:{border:"1px solid #f0f0f0",padding:8,borderRadius:6,background:"#fff"},children:[(0,r.jsxs)("div",{style:{fontSize:13,fontWeight:600},children:["[",e.type,"] ",null!=(n=e.title)?n:e.id]}),e.snippet&&(0,r.jsx)("div",{style:{fontSize:12,color:"#444",marginTop:6},children:e.snippet}),(0,r.jsxs)("div",{style:{marginTop:8},children:["MODEL"===e.type&&(0,r.jsx)("a",{href:"/models/".concat(e.id),target:"_blank",rel:"noreferrer",children:"View model"}),"FILTER"===e.type&&(0,r.jsx)("a",{href:"/filters/".concat(e.id),target:"_blank",rel:"noreferrer",children:"View filter"}),"RUN"===e.type&&(0,r.jsx)("a",{href:"/filters/".concat(null!=(o=e.filterId)?o:"","/runs/").concat(e.id),target:"_blank",rel:"noreferrer",children:"View run"}),"DOC"===e.type&&(0,r.jsx)("a",{href:"/docs/".concat(encodeURIComponent(e.id)),target:"_blank",rel:"noreferrer",children:"Open doc"})]})]},"".concat(e.type,":").concat(e.id,":").concat(t))})})]})]})]})}function u(){return(0,r.jsx)("div",{className:"container mx-auto py-8 px-4",style:{height:"calc(100vh - 4rem)"},children:(0,r.jsx)(p,{userId:"00000000-0000-0000-0000-000000000001",initialSystemMessage:"I'm ModelLens Assistant. I can help you find AI models, understand saved filters, and analyze filter runs. Ask me anything!"})})}},7097:(e,t,n)=>{Promise.resolve().then(n.bind(n,977))}},e=>{e.O(0,[358,812,3,301,438,977],()=>e(e.s=7097)),_N_E=e.O()}]);